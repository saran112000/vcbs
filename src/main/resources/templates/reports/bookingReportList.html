<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Report</title>
    
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/sidebar.css}">
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/fontawesome/css/all.css}">
    <link rel="stylesheet" th:href="@{/fontfamily/css/google_font_family.css}">
    <link rel="stylesheet" th:href="@{/bootstrap/css/dataTables.bootstrap5.css}">
    <link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/bootstrap/css/datepicker-bs5.min.css}">
    
    <script th:src="@{/bootstrap/js/jquery-3.7.1.js}"></script>

	<script th:src="@{/bootstrap/js/dataTables.js}"></script>
	
	<script th:src="@{/bootstrap/js/dataTables.bootstrap5.js}"></script>
	
	<script th:src="@{/bootstrap/js/datepicker-full.min.js}"></script>
	
	<script th:src="@{/bootstrap/js/bootstrap.bundle.min.js}"></script>
	
	<script th:src="@{/sweetalert/js/sweetalert2.all.min.js}"></script>
    
    <script th:inline="javascript">
    /* Defines a global variable for the context path */
    const contextPath = /*[[@{/}]]*/ '';
</script>

</head>
<body>
  


 <div id="dashboardPage" class="page">

        <div class="dashboard-header">
            <div class="header-left">
                <div class="logo-mini">
                    <i class="fas fa-video"></i>
                    <span>VC Booking</span>
                </div>
                <h1>Welcome to Booking Page</h1>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="loggedInUser">User</span>
                </div>
					              <a th:href="@{/login}" style="text-decoration: none;">
					    <button class="btn-logout" id="logoutBtn">
					        <i class="fas fa-sign-out-alt"></i> Logout
					    </button>
					</a>
            </div>
        </div>
        
        
        <div class="sidebar">
			    <ol class="menu" style="list-style: none; padding: 0;">
			        <li class="menu-item" th:each="main : ${mainModuleList}">
			            <span class="menu-title">
			                <i th:class="${main.moduleIcon}" style="margin-right: 10px;"></i>
			                <span th:text="${main.moduleName}">Main Menu</span>
			            </span>
			            
			            <ol class="submenu">
			                <th:block th:each="sub : ${subModuleList}">
			                    <li th:if="${sub.moduleId == main.moduleId}">
			                        <a th:href="@{${sub.moduleDetailsUrl}}" th:text="${sub.moduleDetailsName}">
			                            Sub Menu Item
			                        </a>
			                    </li>
			                </th:block>
			            </ol>
			        </li>
			    </ol>
			</div>
			
			
<!-- MAIN CONTENT -->
<div class="main-content">

    <div class="page-header-report">
        <div>Booking Report</div>
    </div>
		   <form id="bookingReportForm" th:action="@{/booking-report}" method="POST">
    <input type="hidden" name="actionType" id="actionType">

    <div class="row align-items-end" style="justify-content: end; margin-top:-45px; margin-bottom: 10px;">
        <div class="col-md-3">
            <label for="fromDate" class="form-label fw-bold" style="color:white;">From Date</label>
            <input type="text" id="fromDate" name="fromDate" th:value="${fromDate}" 
                   class="form-control datepicker-input" placeholder="Select start date" readonly>
        </div>
        <div class="col-md-3">
            <label for="toDate" class="form-label fw-bold" style="color:white;">To Date</label>
            <input type="text" id="toDate" name="toDate" th:value="${toDate}" 
                   class="form-control datepicker-input" placeholder="Select end date" readonly>
        </div>
        
        <div class="col-md-auto d-flex gap-2">
            <button type="button" class="btn btn-success" onclick="openAction('E')">
                <i class="fas fa-file-excel"></i> Excel
            </button>
            <button type="button" class="btn btn-danger" onclick="openAction('P')">
                <i class="fas fa-file-pdf"></i> PDF
            </button>
        </div>
    </div>
</form>
    <div class="glass-effect">
    
			   <table class="table table-bordered" id="booked-report">
				    <thead class="table-dark">
				        <tr>
				            <th style="width: 5%;">Sl No</th>
				            <th style="width: 10%;">Booked Date</th>
				            <th style="width: 15%;">Room Info</th>
				            <th style="width: 20%;">Guest & Subject</th>
				            <th style="width: 20%;">Booked By</th>
				            <th style="width: 15%;">Time Slots</th>
				        </tr>
				    </thead>
				    
				    <tbody id="bookingTableBody">
				        <tr th:each="booking, iterStat : ${bookingReport}">
				            <td style="text-align:center;" th:text="${iterStat.count + '.'}">1.</td>
				            <td style="text-align:center;" th:text="${#temporals.format(booking.bookingDate, 'dd-MM-yyyy')}">-</td>
				            <td>
				                <b th:text="${booking.roomNo}">-</b><br/>
				                <small class="text-muted" th:text="${booking.roomType}">-</small>
				            </td>
				            <td>
				                <span th:text="${booking.guestName}">-</span><br/>
				                <small th:text="${booking.subject}">-</small>
				            </td>
				            <td>
				                <span th:text="${booking.slotBookedBy != null ? booking.slotBookedBy : '-'}"></span>
				                <span th:if="${booking.slotBookedByDesignation != null}" 
				                      class="badge bg-light text-dark border"
				                      th:text="${booking.slotBookedByDesignation}"></span>
				            </td>
				            <td>
				                <span class="badge bg-info text-dark" th:text="${booking.bookedSlots}">-</span>
				            </td>
				        </tr>
				        
				        <tr th:if="${#lists.isEmpty(bookingReport)}">
				            <td colspan="6" class="text-center">No active bookings found.</td>
				        </tr>
				    </tbody>
				</table>
			</div>
			    
			</div>
		
		    </div> 
		    
		    <script th:if="${bookingReport != null and !bookingReport.isEmpty()}">
			    $(document).ready(function() {
			        $('#booked-report').DataTable({
			            "language": {
			                "emptyTable": "No Bookings found in the system"
			            }
			        });
			    });
			</script>
		    
		    	<script>
	

document.querySelectorAll('.menu-title').forEach(title => {
    title.addEventListener('click', function() {
        const parent = this.parentElement;
        
        // Toggle 'open' class on the clicked menu item
        parent.classList.toggle('open')	;
        
        // Optional: Close other open menus
        document.querySelectorAll('.menu-item').forEach(item => {
            if (item !== parent) {
                item.classList.remove('open');
            }
        });
    });
});
</script>

<script type="text/javascript">

document.addEventListener("DOMContentLoaded", function() {
    const fromInput = document.querySelector('#fromDate');
    const toInput = document.querySelector('#toDate');

    // 1. Initialize Datepickers
    // We don't call setDate() manually here anymore. 
    // The library will automatically detect the value attribute.
    const fromPicker = new Datepicker(fromInput, {
        autohide: true,
        buttonClass: 'btn',
        format: 'dd-mm-yyyy',
        todayBtn: true,
        clearBtn: true,
        orientation: 'bottom left',
        container: 'body' // Keeps picker on top of glass-effect
    });

    const toPicker = new Datepicker(toInput, {
        autohide: true,
        buttonClass: 'btn',
        format: 'dd-mm-yyyy',
        todayBtn: true,
        clearBtn: true,
        orientation: 'bottom left',
        container: 'body'
    });

    // 2. Refresh the picker to recognize the Thymeleaf-provided value
    // This ensures the internal calendar highlight matches the text box value
    if (fromInput.value) {
        fromPicker.setDate(fromInput.value);
    }
    if (toInput.value) {
        toPicker.setDate(toInput.value);
    }
});
</script>


<script type="text/javascript">

document.addEventListener("DOMContentLoaded", function() {
    const form = document.getElementById('bookingReportForm');
    const fromInput = document.getElementById('fromDate');
    const toInput = document.getElementById('toDate');

    // Function for automatic table filtering (GET request)
    function autoFilter() {
        if (fromInput.value && toInput.value) {
            form.method = "GET";
            form.action = contextPath + "reports/bookings"; // Your @GetMapping URL
            form.target = "_self"; // Refresh current page
            form.submit();
        }
    }

    // Attach listeners to datepickers
    fromInput.addEventListener('changeDate', autoFilter);
    toInput.addEventListener('changeDate', autoFilter);
});

// Function for Exporting (POST request)
function openAction(type) {
    const form = document.getElementById('bookingReportForm');
    const fromDate = document.getElementById('fromDate').value;
    const toDate = document.getElementById('toDate').value;

    if (!fromDate || !toDate) {
        Swal.fire({ icon: 'warning', title: 'Missing Dates', text: 'Please select both dates.' });
        return;
    }

    // Configure form for Export
    document.getElementById('actionType').value = type;
    form.method = "POST";
    form.action = contextPath + "booking-report"; // Your @PostMapping URL
    form.target = "_blank"; // Open in new tab for PDF preview
    form.submit();
}

</script>
    
	
</body>



</html>


