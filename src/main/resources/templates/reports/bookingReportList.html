<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Report</title>
    
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/sidebar.css}">
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/fontawesome/css/all.css}">
    <link rel="stylesheet" th:href="@{/fontfamily/css/google_font_family.css}">
    <link rel="stylesheet" th:href="@{/bootstrap/css/dataTables.bootstrap5.css}">
    <link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/bootstrap/css/datepicker-bs5.min.css}">
    
    <script th:src="@{/bootstrap/js/jquery-3.7.1.js}"></script>

	<script th:src="@{/bootstrap/js/dataTables.js}"></script>
	
	<script th:src="@{/bootstrap/js/dataTables.bootstrap5.js}"></script>
	
	<script th:src="@{/bootstrap/js/datepicker-full.min.js}"></script>
	
	<script th:src="@{/bootstrap/js/bootstrap.bundle.min.js}"></script>
	
	<script th:src="@{/sweetalert/js/sweetalert2.all.min.js}"></script>
    
    <script th:inline="javascript">
    /* Defines a global variable for the context path */
    const contextPath = /*[[@{/}]]*/ '';
</script>

</head>
<body>
  


 <div id="dashboardPage" class="page">

        <div class="dashboard-header">
            <div class="header-left">
                <div class="logo-mini">
                    <i class="fas fa-video"></i>
                    <span>VC Booking</span>
                </div>
                <h1>Welcome to Booking Page</h1>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="loggedInUser">User</span>
                </div>
					              <a th:href="@{/login}" style="text-decoration: none;">
					    <button class="btn-logout" id="logoutBtn">
					        <i class="fas fa-sign-out-alt"></i> Logout
					    </button>
					</a>
            </div>
        </div>
        
        
        <div class="sidebar">
			    <ol class="menu" style="list-style: none; padding: 0;">
			        <li class="menu-item" th:each="main : ${mainModuleList}">
			            <span class="menu-title">
			                <i th:class="${main.moduleIcon}" style="margin-right: 10px;"></i>
			                <span th:text="${main.moduleName}">Main Menu</span>
			            </span>
			            
			            <ol class="submenu">
			                <th:block th:each="sub : ${subModuleList}">
			                    <li th:if="${sub.moduleId == main.moduleId}">
			                        <a th:href="@{${sub.moduleDetailsUrl}}" th:text="${sub.moduleDetailsName}">
			                            Sub Menu Item
			                        </a>
			                    </li>
			                </th:block>
			            </ol>
			        </li>
			    </ol>
			</div>
			
			
<!-- MAIN CONTENT -->
<div class="main-content">

    <div class="page-header-report">
        <div>Booking Report</div>
    </div>
		    <form id="bookingReportForm" th:action="@{/booking-report}" method="POST" target="_blank">
		    <input type="hidden" name="actionType" id="actionType">
		
		    <div class="row align-items-end" style="justify-content: end; margin-top:-45px; margin-bottom: 10px;">
		        <div class="col-md-3">
		            <label for="fromDate" class="form-label fw-bold" style="color:white;">From Date</label>
		            <input type="text" id="fromDate" name="fromDate" class="form-control datepicker-input" placeholder="Select start date" readonly>
		        </div>
		        <div class="col-md-3">
		            <label for="toDate" class="form-label fw-bold" style="color:white;">To Date</label>
		            <input type="text" id="toDate" name="toDate" class="form-control datepicker-input" placeholder="Select end date" readonly>
		        </div>
		        
		        <div class="col-md-auto d-flex gap-2">
		            <button type="button" class="btn btn-success" style="display: flex; align-items: center; gap: 8px;" onclick="openAction('E')">
		                <i class="fas fa-file-excel"></i> Excel
		            </button>
		            
		            <button type="button" class="btn btn-danger" style="display: flex; align-items: center; gap: 8px;" onclick="openAction('P')">
		                <i class="fas fa-file-pdf"></i> PDF
		            </button>
		        </div>
		    </div>
		</form>
    <div class="glass-effect">
    
			   <table class="table table-bordered" id="booked-report">
				    <thead class="table-dark">
				        <tr>
				            <th style="width: 5%;">Sl No</th>
				            <th style="width: 10%;">Booked Date</th>
				            <th style="width: 15%;">Room Info</th>
				            <th style="width: 20%;">Guest & Subject</th>
				            <th style="width: 20%;">Booked By</th>
				            <th style="width: 15%;">Time Slots</th>
				        </tr>
				    </thead>
				    
				    <tbody id="bookingTableBody">
				        <tr th:each="booking, iterStat : ${bookingReport}">
				            <td style="text-align:center;" th:text="${iterStat.count + '.'}">1.</td>
				
				            <td style="text-align:center;" th:text="${#temporals.format(booking.bookingDate, 'dd-MM-yyyy')}">-</td>
				
				            <td>
				                <b th:text="${booking.roomNo}">-</b><br/>
				                <small class="text-muted" th:text="${booking.roomType}">-</small>
				            </td>
				
				            <td>
				                <span th:text="${booking.guestName}">-</span><br/>
				                <small th:text="${booking.subject}">-</small>
				            </td>
				            
				            <td>
				                <span th:text="${booking.slotBookedBy != null ? booking.slotBookedBy : '-'}"></span>
				                <span th:if="${booking.slotBookedByDesignation != null}" 
				                      class="badge bg-light text-dark border"
				                      th:text="${booking.slotBookedByDesignation}"></span>
				            </td>
				
				            <td>
				                <span class="badge bg-info text-dark" th:text="${booking.bookedSlots}">-</span>
				            </td>
				
				           
				        </tr>
				        <tr th:if="${#lists.isEmpty(bookingReport)}">
				            <td colspan="7" class="text-center">No active bookings found.</td>
				        </tr>
				    </tbody>
				</table>
				
			</div>
			    
			</div>
		
		    </div> 
		    
		    	<script>
	
	$(document).ready(function() {
	    $('#booked-report').DataTable({
	        "language": {
	            "emptyTable": "No Bookings found in the system"
	        }
	    });
	});


document.querySelectorAll('.menu-title').forEach(title => {
    title.addEventListener('click', function() {
        const parent = this.parentElement;
        
        // Toggle 'open' class on the clicked menu item
        parent.classList.toggle('open')	;
        
        // Optional: Close other open menus
        document.querySelectorAll('.menu-item').forEach(item => {
            if (item !== parent) {
                item.classList.remove('open');
            }
        });
    });
});
</script>

<script type="text/javascript">

document.addEventListener("DOMContentLoaded", function() {
    const fromInput = document.querySelector('#fromDate');
    const toInput = document.querySelector('#toDate');

    // 1. Calculate Dates
    const today = new Date();
    // First day of current month: Year, Current Month, Day 1
    const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);

    // 2. Initialize Datepickers
    const fromPicker = new Datepicker(fromInput, {
        autohide: true,
        buttonClass: 'btn',
        format: 'dd-mm-yyyy',
        todayBtn: true,
        clearBtn: true,
        orientation: 'bottom left'
    });

    const toPicker = new Datepicker(toInput, {
        autohide: true,
        buttonClass: 'btn',
        format: 'dd-mm-yyyy',
        todayBtn: true,
        clearBtn: true,
        orientation: 'bottom left'
    });

    // 3. Set Default Values
    fromPicker.setDate(firstDayOfMonth);
    toPicker.setDate(today);
});

</script>

<script type="text/javascript">

function openAction(type) {
    const fromDate = document.getElementById('fromDate').value;
    const toDate = document.getElementById('toDate').value;

    if (!fromDate || !toDate) {
        Swal.fire({
            icon: 'warning',
            title: 'Missing Dates',
            text: 'Please select both From and To dates.'
        });
        return;
    }

    // Set the hidden input value
    document.getElementById('actionType').value = type;

    // Submit the form
    document.getElementById('bookingReportForm').submit();
}


</script>
    
	
</body>



</html>


