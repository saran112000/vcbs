<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="_csrf" th:content="${_csrf.token}"/>
	<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/fontawesome/css/all.css}">
    <link rel="stylesheet" th:href="@{/fontfamily/css/google_font_family.css}">
    <link rel="stylesheet" th:href="@{/css/sidebar.css}">
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <script th:src="@{/js/script.js}"></script>
    
       
    <script th:src="@{/js/script.js}" defer></script>
  
    <script th:src="@{/bootstrap/js/jquery-3.7.1.js}"></script>

	<script th:src="@{/bootstrap/js/dataTables.js}"></script>
	
	<script th:src="@{/bootstrap/js/dataTables.bootstrap5.js}"></script>
	
	<script th:src="@{/bootstrap/js/bootstrap.bundle.min.js}"></script>
	
	<script th:src="@{/sweetalert/js/sweetalert2.all.min.js}"></script>
    
    <script th:inline="javascript">
    /* Defines a global variable for the context path */
    const contextPath = /*[[@{/}]]*/ '';
</script>
    

</head>
<body>



 <div id="dashboardPage" class="page" th:fragment="header_nav">

        <div class="dashboard-header">
            <div class="header-left">
                <div class="logo-mini">
                    <i class="fas fa-video"></i>
                    <span>VC Booking</span>
                </div>
                <h1>Welcome to Booking Page</h1>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="loggedInUser">User</span>
                </div>
					              <a th:href="@{/login}" style="text-decoration: none;">
					    <button class="btn-logout" id="logoutBtn">
					        <i class="fas fa-sign-out-alt"></i> Logout
					    </button>
					</a>
            </div>
        </div>
        
        
        
	<div class="sidebar">
    <ol class="menu" style="list-style: none; padding: 0;">
        <li class="menu-item">
            <span class="menu-title">
                <i class="fas fa-database" style="margin-right: 10px;"></i> Master
            </span>
            <ol class="submenu">
                <li><a th:href="@{/login-list}">Login List</a></li>
                <li><a th:href="@{/officer}">Officer</a></li>
                <li><a th:href="@{/division/list}">Division</a></li>
                  <li><a th:href="@{/Rooms}">Rooms</a></li>
            </ol>
        </li>

        <li class="menu-item">
            <span class="menu-title">
                <i class="fas fa-file-alt" style="margin-right: 10px;"></i> Reports
            </span>
            <ol class="submenu">
                <li><a th:href="@{/Booking-report}">Booking  Report</a></li>
                <li><a th:href="@{/Cancle-report}">Cancle Report</a></li>
            </ol>
        </li>
        
         <li class="menu-item">
            <span class="menu-title">
                <i class="fas fa-file-alt" style="margin-right: 10px;"></i> Booking
            </span>
            <ol class="submenu">
                <li><a th:href="@{/bookings}">Drona Booking</a></li>
                <li><a th:href="@{/Internet-Report}">Internet Report</a></li>
            </ol>
        </li>
    </ol>
</div>
<!-- MAIN CONTENT -->
 <div class="content">

            <div class="content-section">

            
					                <div class="page-header">
					        <h2><i class="fas fa-user-plus"></i> Room Booking</h2>
					        
					    </div>

                <!-- ===== Room Selection ===== -->
                <div class="card">
                
                
                  <form id="bookingForm" th:action="@{/booking/add}" th:object="${booking}" method="POST">

    <div class="card">
        <div class="form-row">

            <div class="input-group">
                <label>Room Type</label>
                <select name="roomTypeId" id="roomType" onchange="filterRoomsByType()">
                    <option value="">Select Room Type</option>
                    <option th:each="room : ${roomsType}"
                            th:value="${room.roomTypeId}"
                            th:text="${room.roomType}">
                    </option>
                </select>
            </div>

            <div class="input-group">
                <label>Room No</label>
                <select name="roomId" id="roomNo">
                    <option value="">Select Room No</option>
                </select>
            </div>

            <div class="input-group">
                <label>Date</label>
                <input type="date" name="bookingDate" id="bookingDate">
            </div>

            <div class="input-group">
                <label>Employee Name</label>
                <select name="employeeId" id="employeeId">
                    <option value="">Select Employee</option>
                </select>
            </div>

            <div class="input-group">
                <label>Guest</label>
                <input type="text" name="guest" id="guest" placeholder="Enter guest name">
            </div>

            <div class="input-group">
                <label>Subject</label>
                <input type="text" name="subject" id="subject" placeholder="Enter meeting subject">
            </div>

        </div>
    </div>

    <!-- ===== Time Slots (MULTI SELECT) ===== -->
    <br>
    <div class="card">
        <h3><i class="fas fa-clock"></i> Time Slots</h3>

        <div class="time-slots">

            <!-- Each slot is a checkbox -->
            <label class="slot">
                <input type="checkbox" name="slotTimes" value="09:00 - 09:30"> 09:00 - 09:30
            </label>

            <label class="slot">
                <input type="checkbox" name="slotTimes" value="09:30 - 10:00"> 09:30 - 10:00
            </label>

            <label class="slot">
                <input type="checkbox" name="slotTimes" value="10:00 - 10:30"> 10:00 - 10:30
            </label>

            <label class="slot">
                <input type="checkbox" name="slotTimes" value="10:30 - 11:00"> 10:30 - 11:00
            </label>
             <label class="slot">
                <input type="checkbox" name="slotTimes" value="10:30 - 11:00"> 11:00 - 11:30
            </label>
            <label class="slot">
                <input type="checkbox" name="slotTimes" value="10:30 - 11:00"> 11:30 - 12:00
            </label>
            <label class="slot">
                <input type="checkbox" name="slotTimes" value="10:30 - 11:00"> 12:30 - 1:00
            </label>
            <label class="slot">
                <input type="checkbox" name="slotTimes" value="10:30 - 11:00"> 1:30 - 2:00
            </label>
            <label class="slot">
                <input type="checkbox" name="slotTimes" value="10:30 - 11:00"> 2:30 - 3:00
            </label>
            <label class="slot">
                <input type="checkbox" name="slotTimes" value="10:30 - 11:00"> 3:00 - 3:30
            </label>
            <label class="slot">
                <input type="checkbox" name="slotTimes" value="10:30 - 11:00"> 3:30 - 4:00
            </label>
            <label class="slot">
                <input type="checkbox" name="slotTimes" value="10:30 - 11:00"> 4:00 - 4:30
            </label>
            

           

        </div>
    </div>

    <div class="action-buttons">
        <button type="button" class="btn-book-slot" onclick="submitBookingForm()">
            <i class="fas fa-check-circle"></i> Book Slot
        </button>
    </div>

</form>
                  
                </div>
               

                

            </div>
        </div>
        

    </div>
   


    </div> 
</body>
<script>
/* ================================
   GLOBAL VARIABLES
================================ */
let selectedSlotTime = null;

/* ================================
   BOOK SLOT BUTTON CLICK
================================ */
/* document.querySelector('.btn-book-slot').addEventListener('click', function () {

    const roomId = document.getElementById("roomNo").value;
    const bookingDate = document.querySelector('input[type="date"]').value;
    const guest = document.querySelector('input[placeholder="Enter guest name"]').value;
    const subject = document.querySelector('input[placeholder="Enter meeting subject"]').value;
    const slotTime = selectedSlotTime;

    if (!roomId || !bookingDate || !guest || !subject || !slotTime) {
        Swal.fire("Warning", "Please fill all fields and select a slot", "warning");
        return;
    }
    
    console.log("${contextPath}*****"+contextPath);

    const token = document.querySelector('meta[name="_csrf"]').content;
    const header = document.querySelector('meta[name="_csrf_header"]').content;

    fetch(`${contextPath}api/book-slot`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ roomId, bookingDate, guest, subject, slotTime })
    })
    .then(data => {
        if (!data) return; // Exit if redirected
        if (data.status === "SUCCESS") {
            Swal.fire("Success", "Slot booked successfully", "success");
            resetForm();
        } else {
            Swal.fire("Error", data.message || "Booking failed", "error");
        }
    })
    .catch(err => {
        console.error("Fetch Error:", err);
        Swal.fire("Error", "Session may have expired. Please refresh.", "error");
    });
}); */


function submitEmployeeForm() {
	const roomId = document.getElementById("roomNo").value;
    const bookingDate = document.querySelector('input[type="date"]').value;
    const guest = document.querySelector('input[placeholder="Enter guest name"]').value;
    const subject = document.querySelector('input[placeholder="Enter meeting subject"]').value;
    const slotTime = selectedSlotTime;

    if (!empNo || !empName || desigId === "0") {
        Swal.fire("Validation Error", "Please fill required fields (No, Name, Designation)", "warning"); 
        return;
    }

    Swal.fire({
        title: "Confirm Save",
        text: `Are you sure you want to book the slot this employee?`, 
        icon: "question",
        showCancelButton: true,
        confirmButtonText: "Yes, Save"
    }).then((result) => {
        if (result.isConfirmed) form.submit();
    });
}


/* ================================
   SLOT SELECTION
================================ */
document.querySelectorAll('.slot').forEach(slot => {
    slot.addEventListener('click', () => {

        if (slot.classList.contains('booked')) return;

        document.querySelectorAll('.slot').forEach(s => s.classList.remove('active'));
        slot.classList.add('active');

        selectedSlotTime = slot.dataset.time;
    });
});

/* ================================
   FILTER ROOMS BY TYPE
================================ */
function filterRoomsByType() {

    const typeId = document.getElementById("roomType").value;
    const roomNoSelect = document.getElementById("roomNo");

    roomNoSelect.innerHTML = '<option value="">Select Room No</option>';

    if (!typeId) return;

    fetch(`${contextPath}api/rooms-by-type?typeId=${typeId}`)
        .then(res => {
            if (!res.ok) throw new Error();
            return res.json();
        })
        .then(rooms => {
            rooms.forEach(room => {
                const option = document.createElement("option");
                option.value = room.roomId;
                option.textContent = room.roomNo;
                roomNoSelect.appendChild(option);
            });
        })
        .catch(() => {
            Swal.fire("Error", "Failed to load rooms", "error");
        });
}

/* ================================
   LOAD BOOKED SLOTS
================================ */
function loadBookedSlots() {

    const roomId = document.getElementById("roomNo").value;
    const bookingDate = document.querySelector('input[type="date"]').value;

    if (!roomId || !bookingDate) return;

    /* fetch(`${contextPath}api/booked-slots?roomId=${roomId}&bookingDate=${bookingDate}`)
        .then(res => res.json())
        .then(bookedSlots => {

            document.querySelectorAll('.slot').forEach(slot => {

                if (bookedSlots.includes(slot.dataset.time)) {
                    slot.classList.add('booked');
                    slot.disabled = true;
                } else {
                    slot.classList.remove('booked');
                    slot.disabled = false;
                }
            });
        }); */
}

/* ================================
   SAFE EVENT LISTENER
================================ */
function addListener(selector, event, callback) {
    const el = document.querySelector(selector);
    if (el) el.addEventListener(event, callback);
}

/* ================================
   FORM RESET
================================ */
function resetForm() {

    document.getElementById("roomType").value = "";
    document.getElementById("roomNo").innerHTML = '<option value="">Select Room No</option>';
    document.querySelector('input[type="date"]').value = "";
    document.querySelector('input[placeholder="Enter guest name"]').value = "";
    document.querySelector('input[placeholder="Enter meeting subject"]').value = "";

    selectedSlotTime = null;

    document.querySelectorAll('.slot').forEach(slot => {
        slot.classList.remove('active', 'booked');
        slot.disabled = false;
    });
}

/* ================================
   TRIGGER ON ROOM / DATE CHANGE
================================ */
addListener('select[name="roomNo"]', 'change', loadBookedSlots);
addListener('input[type="date"]', 'change', loadBookedSlots);

/* ================================
   SIDEBAR MENU TOGGLE
================================ */
document.querySelectorAll('.menu-title').forEach(title => {
    title.addEventListener('click', function () {
        const parent = this.parentElement;

        parent.classList.toggle('open');

        document.querySelectorAll('.menu-item').forEach(item => {
            if (item !== parent) item.classList.remove('open');
        });
    });
});
</script>



</html>


